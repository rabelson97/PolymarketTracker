<!-- anchor: project-plan-root -->
# Project Plan: Polymarket Fresh Wallet Tracker

**Version:** 1.0  
**Date:** 2025-11-01  
**Generated By:** ChatGPT (GPT-4.1 Architecture Planner)

<!-- anchor: project-overview -->
## 1. Project Overview

<!-- anchor: project-goal -->
*   **Goal:** Automate the identification of high-value fresh wallets on Polymarket by filtering first-time bettors with large balances and margins.

<!-- anchor: high-level-requirements -->
*   **High-Level Requirements Summary:**
    - Detect wallets executing their first recorded bet within a configurable lookback window.
    - Enforce minimum wallet balance threshold of USD 50,000 before reporting.
    - Calculate bet margin and require a minimum USD 5,000 margin for inclusion.
    - Persist processed data for caching and export results as JSON/CSV/console summaries.
    - Provide configurable batch execution without real-time guarantees.

<!-- anchor: key-assumptions -->
*   **Key Assumptions:**
    - Python 3.11 runtime is available with network access to Polymarket endpoints and Polygon RPC.
    - Margin definition aligns with provided specification (stake vs potential payout difference) and can be refined via configuration.
    - Batch jobs run within controlled infrastructure (Dockerized CLI or scheduled task) with environment-based secrets management.
    - Polymarket APIs and Polygon RPC expose sufficient data to determine first bet timing and current balances.

<!-- anchor: core-architecture -->
## 2. Core Architecture

<!-- anchor: architectural-style -->
*   **Architectural Style:** Modular, batch-oriented layered architecture with hexagonal (ports and adapters) separation between domain logic and infrastructure.

<!-- anchor: technology-stack -->
*   **Technology Stack:**
    *   **Frontend:** None (CLI-based tooling).
    *   **Backend:** Python 3.11 with Typer CLI, requests, py-clob-client, web3.py.
    *   **Database:** Embedded SQLite (primary) with optional JSON snapshot cache for lightweight deployments.
    *   **Messaging/Queues:** None in scope; future extension placeholder for event streaming.
    *   **Deployment:** Containerized batch job (Docker) triggered via cron/EventBridge; supports local CLI execution.
    *   **Other Key Libraries/Tools:** python-dotenv for configuration, structlog for structured logging, pytest/responses for testing, Pandas optional for richer exports.

<!-- anchor: key-components -->
*   **Key Components/Services:**
    - **Data Fetcher Module:** Retrieves recent trades and markets from Polymarket APIs; documented via Component Diagram (PlantUML) in `I1.T2`.
    - **Wallet Analyzer Module:** Determines wallet freshness, computes margins, and requests balance checks; sequence detailed in Wallet Evaluation Sequence Diagram (PlantUML) from `I2.T2`.
    - **Balance Provider Adapter:** Uses web3.py or py-clob-client to query Polygon balances; adapter contract specified in `I1.T3` API stub documentation.
    - **Cache & Storage Layer:** Persists wallet snapshots and run metadata in SQLite/JSON; ERD (Mermaid) drafted in `I1.T2`.
    - **Reporter Module:** Generates JSON/CSV exports and console summaries; export schemas refined in `I3.T1`.

<!-- anchor: data-model-overview -->
*   **Data Model Overview:** Core entities include Wallet, Bet, WalletSnapshot, and RunMetadata with relationships captured in the ERD (Mermaid) produced during `I1.T2`. WalletSnapshot stores thresholds (balance, margin) and timestamps to prevent duplicate processing across runs.

<!-- anchor: api-contract-style -->
*   **API Contract Style:** Internal REST-like adapters wrapping Polymarket HTTP endpoints with typed Python interfaces; external contract captured as OpenAPI v3 YAML stub in `I2.T1`. No public API exposed beyond CLI.

<!-- anchor: communication-patterns -->
*   **Communication Patterns:** Synchronous batch orchestration invoking adapters via ports; retried HTTP/JSON-RPC calls with caching to avoid redundant balance queries. Sequence diagram for wallet evaluation created in `I2.T2` clarifies interactions among orchestrator, analyzer, cache, and external services.

<!-- anchor: key-artifacts -->
## 2.1. Key Architectural Artifacts Planned

*   Component Diagram (PlantUML) - Visualizes module boundaries and adapters; created in `I1.T2` at `docs/diagrams/component_overview.puml`.
*   Data Model ERD (Mermaid) - Captures Wallet, Bet, Snapshot relationships; created in `I1.T2` at `docs/diagrams/data_model.mmd`.
*   OpenAPI Stub (YAML) - Documents Polymarket ingestion endpoints and internal adapter contracts; drafted in `I2.T1` at `api/polymarket_client.yaml`.
*   Wallet Evaluation Sequence Diagram (PlantUML) - Details runtime interactions for identifying fresh wallets; produced in `I2.T2` at `docs/diagrams/wallet_evaluation_sequence.puml`.
*   Reporting Schema Definition (JSON Schema) - Formalizes export payload structure; created in `I3.T1` at `docs/schemas/fresh_wallet_report.schema.json`.
*   Configuration Reference (Markdown) - Lists environment variables and defaults; compiled in `I1.T1` at `docs/configuration.md`.

<!-- anchor: directory-structure -->
## 3. Directory Structure

*   **Root Directory:** `polymarket-fresh-wallet-tracker/`
*   **Structure Definition:**
    ~~~
    polymarket-fresh-wallet-tracker/
    ├── src/
    │   ├── polymarket_tracker/
    │   │   ├── __init__.py
    │   │   ├── cli.py               # Typer CLI entrypoint
    │   │   ├── config.py            # Configuration loading utilities
    │   │   ├── adapters/
    │   │   │   ├── polymarket_client.py
    │   │   │   └── balance_provider.py
    │   │   ├── services/
    │   │   │   ├── data_fetcher.py
    │   │   │   ├── wallet_analyzer.py
    │   │   │   └── reporter.py
    │   │   └── storage/
    │   │       ├── cache_gateway.py
    │   │       └── models.py
    │   └── tests/
    │       ├── __init__.py
    │       ├── test_wallet_analyzer.py
    │       ├── test_data_fetcher.py
    │       └── fixtures/
    ├── api/
    │   └── polymarket_client.yaml
    ├── docs/
    │   ├── configuration.md
    │   ├── diagrams/
    │   │   ├── component_overview.puml
    │   │   ├── data_model.mmd
    │   │   └── wallet_evaluation_sequence.puml
    │   ├── schemas/
    │   │   └── fresh_wallet_report.schema.json
    │   └── adr/
    │       └── README.md
    ├── data/
    │   ├── cache.sqlite
    │   └── exports/
    ├── scripts/
    │   └── run_batch.py
    ├── .env.example
    ├── Dockerfile
    ├── pyproject.toml
    ├── README.md
    └── requirements.txt
    ~~~
    Rationale: Separates adapters, services, and storage to follow ports-and-adapters principles; dedicates `docs/diagrams` and `docs/schemas` for text-based artifacts; includes `data/` for runtime cache/output segregation and `scripts/` for orchestration helpers.
